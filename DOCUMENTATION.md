# ESP8266 Clock Project - Документація

## Опис проекту

Цифровий годинник на базі ESP8266 з дисплеєм TM1637, модулем реального часу DS1307, WiFi Manager для налаштування мережі, синхронізацією часу через NTP та веб-інтерфейсом для налаштування часової зони.

## Апаратні компоненти

1. **ESP8266 NodeMCU V2** - мікроконтролер з WiFi
2. **TM1637** - 4-розрядний 7-сегментний дисплей
3. **DS1307** - модуль реального часу (RTC) з батарейним живленням
4. **З'єднувальні проводи**

## GPIO розводка

| Компонент | Сигнал | GPIO ESP8266 | Пін на NodeMCU | Опис |
|-----------|--------|--------------|----------------|------|
| TM1637 | CLK | GPIO14 | D5 | Тактовий сигнал дисплея |
| TM1637 | DIO | GPIO12 | D6 | Лінія даних дисплея |
| DS1307 | SDA | GPIO4 | D2 | I2C лінія даних |
| DS1307 | SCL | GPIO5 | D1 | I2C тактовий сигнал |
| Загальні | VCC | 3.3V/5V | 3V3/VIN | Живлення |
| Загальні | GND | GND | GND | Земля |

### Примітки щодо підключення:
- **TM1637**: Підключити VCC до 5V (VIN), GND до GND
- **DS1307**: Підключити VCC до 5V (VIN), GND до GND, переконатися що батарейка CR2032 встановлена для збереження часу

## Використані бібліотеки

| Бібліотека | Версія | Призначення |
|------------|--------|-------------|
| tzapu/WiFiManager | 0.16.0 | Автоматичне налаштування WiFi через веб-портал |
| akj7/TM1637 Driver | 2.2.1 | Керування 7-сегментним дисплеєм TM1637 |
| adafruit/RTClib | 2.1.4 | Робота з модулем реального часу DS1307 |
| arduino-libraries/NTPClient | 3.2.1 | Синхронізація часу через NTP протокол |
| ESP8266WebServer | 1.0 | Вбудована бібліотека для веб-сервера |
| ESP8266WiFi | 1.0 | Вбудована бібліотека для WiFi |
| EEPROM | 1.0 | Збереження налаштувань часової зони |
| Wire | 1.0 | I2C комунікація з DS1307 |

## Функціональність

### 1. Відображення часу
- Формат: HH:MM (години:хвилини)
- Двокрапка миготить з частотою 1 Гц (оновлення кожні 500 мс)
- Час зчитується з модуля DS1307

### 2. WiFi підключення
- При першому запуску або відсутності збережених даних WiFi створюється точка доступу **"ClockSetup"** з паролем **"clock1234"**
- Підключіться до цієї мережі та відкрийте браузер - автоматично відкриється портал налаштування
- Виберіть вашу WiFi мережу та введіть пароль
- Після успішного підключення годинник автоматично синхронізує час через NTP

### 3. Синхронізація часу
- При підключенні до WiFi автоматично виконується синхронізація з NTP сервером (pool.ntp.org)
- Час коригується згідно з обраною часовою зоною
- Після синхронізації час зберігається в DS1307
- Якщо WiFi недоступний, годинник продовжує показувати час з DS1307

### 4. Веб-інтерфейс
Доступний після підключення до WiFi за IP адресою пристрою (відображається в Serial Monitor).

#### Endpoints:
- **`/`** - Головна сторінка з вибором часової зони
- **`/getTime`** - API endpoint для отримання поточного часу (формат: HH:MM:SS)
- **`/setTimezone`** - POST endpoint для встановлення часової зони

#### Доступні часові зони:
- UTC-12:00 до UTC+14:00 з кроком 1 година
- Спеціальні зони: UTC+02:00 (EET), UTC+03:00 (EEST) для України

### 5. Збереження налаштувань
- Обрана часова зона зберігається в EEPROM
- При перезавантаженні налаштування зберігаються
- Автоматична валідація збережених даних

## Налаштування та використання

### Перше підключення:
1. Завантажте прошивку на ESP8266
2. Пристрій створить WiFi точку доступу "ClockSetup"
3. Підключіться до неї (пароль: clock1234)
4. Відкрийте браузер - автоматично відкриється портал
5. Виберіть вашу WiFi мережу та введіть пароль
6. Після підключення відкрийте Serial Monitor (115200 baud) щоб побачити IP адресу
7. Відкрийте веб-інтерфейс за IP адресою
8. Виберіть вашу часову зону та натисніть "Update Timezone & Sync Time"

### Зміна часової зони:
1. Підключіться до тієї ж WiFi мережі
2. Відкрийте веб-інтерфейс за IP адресою ESP8266
3. Виберіть нову часову зону
4. Натисніть "Update Timezone & Sync Time"
5. Час автоматично синхронізується з NTP

### Скидання WiFi налаштувань:
Якщо потрібно підключитися до іншої WiFi мережі:
1. Натисніть та утримуйте кнопку FLASH на NodeMCU під час завантаження
2. Або видаліть збережені налаштування WiFi через код

## Особливості роботи

### Fallback механізм:
- Якщо WiFi з'єднання втрачено, годинник продовжує працювати з DS1307
- При відновленні з'єднання можна знову синхронізувати час через веб-інтерфейс

### Точність часу:
- DS1307 має точність ±2 ppm при 25°C
- Періодична синхронізація через NTP забезпечує високу точність
- Батарейка CR2032 забезпечує збереження часу при відключенні живлення

### Споживання пам'яті:
- RAM: 42.6% (34912 байт з 81920 байт)
- Flash: 31.8% (331647 байт з 1044464 байт)
- Достатньо місця для додаткових функцій

## Компіляція та завантаження

### Використання PlatformIO:

```bash
# Компіляція проекту
pio run

# Завантаження на пристрій
pio run --target upload

# Відкрити Serial Monitor
pio device monitor
```

### Налаштування Serial Monitor:
- Швидкість: 115200 baud
- Newline: LF або CR+LF

## Можливі покращення

1. **Додаткові функції:**
   - Будильник
   - Відображення температури (DS1307 має вбудований термометр)
   - Регулювання яскравості дисплея
   - OTA (Over-The-Air) оновлення прошивки

2. **Покращення інтерфейсу:**
   - MDNS для доступу за доменним ім'ям (напр., clock.local)
   - Більш детальна статистика
   - Історія синхронізацій

3. **Розширення апаратури:**
   - Кнопки для ручного налаштування
   - Датчик освітлення для автоматичного регулювання яскравості
   - Звуковий сигнал

## Усунення несправностей

### Дисплей не світиться:
- Перевірте підключення VCC та GND
- Перевірте з'єднання CLK (D5) та DIO (D6)
- Перевірте яскравість дисплея (встановлена на 7 з 7)

### Час не зберігається:
- Перевірте батарейку CR2032 в модулі DS1307
- Перевірте I2C підключення (SDA на D2, SCL на D1)

### WiFi не підключається:
- Перевірте що ESP8266 у режимі AP (точка доступу "ClockSetup")
- Перевірте діапазон WiFi (тільки 2.4 GHz підтримується)
- Спробуйте скинути налаштування WiFi

### Час неправильний:
- Перевірте обрану часову зону у веб-інтерфейсі
- Виконайте повторну синхронізацію через веб-інтерфейс
- Перевірте що ESP8266 має доступ до інтернету

## Ліцензія та підтримка

Проект створено для освітніх цілей. Використані бібліотеки мають свої власні ліцензії:
- WiFiManager: MIT License
- TM1637 Driver: GPL-3.0
- RTClib: Адресуйтесь до Adafruit
- NTPClient: MIT License

## Автор

Створено з використанням PlatformIO та Arduino Framework для ESP8266.

**Версія документації:** 1.0  
**Дата:** Грудень 2025

